# 关系代数

## 关系模型

现实世界存在各种实体之间的关系。关系模型中数据的逻辑结构是二维表，表的行称为元组，表的列称为属性。

每个属性的可能取值范围称为**域**。域的取值一般具有相同的数据类型，如整数、字符串等。

属性一般而言被认为是原子的，即不可再分的。在实际情况中，可能存在部分属性为`null`的情况。

通过对一组域进行笛卡尔积，其中的一部分子集，用$R(D_1, D_2, \cdots, D_n)$表示，其中$D_1, D_2, \cdots, D_n$为域。$R$ 是关系名，$n$ 是关系的度。

关系就是笛卡尔积中有意义的子集，也可表示为二维表。

## 码

> to be continued

## 完整性

> to be continued

## 关系代数

关系代数用一种过程化的语言描述关系数据库的操作。关系代数的基本操作包括：

- 选择（Selection）：$\sigma$
- 投影（Projection）：$\Pi$
- 更名（Rename）：$\rho$
- 并（Union）：$\cup$
- 差（Difference）：$-$
- 笛卡尔积（Cartesian Product）：$\times$

关系代数以一个或者多个的关系作为输入，产生一个新的关系作为结果。

### 选择

选择操作用于从关系中选择满足某种条件的元组。其中$p$称为选择谓词，是一个命题演算公式。
$$
\sigma_{p}(R)
$$

$p$可写作属性名和常量的比较，如 $age > 20 \wedge sex = 'M'$。

比如：

$$
\sigma_{age > 20 \wedge sex = 'M'}(Student)
$$

### 投影

投影操作用于从关系中选择出一部分属性。

$$
\Pi_{A_1, A_2, \cdots, A_n}(R)
$$

由于关系是一种集合，重复的元组会被去重。

### 并

并操作用于将两个关系的元组合并。要使得$r\cup s$这个操作有意义，需要满足：

1. $r$ 和 $s$ 的属性个数相同
2. $r$ 和 $s$ 的属性的域必须对应相容，即对应位置的属性的数据类型必须相同

举个例子：查询2022年和2023年的数据库课程的学生名单。

$$
\sigma_{year = 2022}(Course) \cup \sigma_{year = 2023}(Course)
$$

### 差

差操作用于从一个关系中去除另一个关系中的元组。有意义所需要求和并操作相同。

### 笛卡尔积

这部分内容在离散数学里面讲过，就是把每个元素进行完全的排列组合。不多赘述。但是很显然在大多数情况下单独使用毫无意义。

### 更名

更名操作用于对关系的属性进行重命名。

$$
\rho_{x(A_1, A_2, \dots , A_n)}(E)
$$

就是把$E$的属性名改为$x$，并且其中每个属性的名字也改为$A_1, A_2, \dots , A_n$。

这个的作用在于，当两个关系进行并操作的时候，如果有相同的属性名，就会出现冲突；自己对自己进行操作的时候也可以为了方便理解在不同的地方更改为不同的名字。

### $\theta$-连接

从两个关系的笛卡尔积里面选取满足给定属性的一个特定条件的元组。

$$
r \underset{\theta}{\Join} s = \sigma_\theta(r \times s)
$$

其中，$\theta$是一个谓词，它对应于$r$和$s$的属性之间的条件。$\theta$-连接实际上就是先对两个关系做笛卡尔积，然后再根据给定的条件进行选择。

例如，要连接Student和Course关系，条件是Student.id = Course.student_id：

$$
Student \underset{Student.id = Course.student\_ id}{\Join} Course
$$

这将返回所有学生及其选修课程的组合，只包含学生ID与课程中的学生ID匹配的元组。

在大多数情况下，存在**自然连接**的可能性，即两个关系中有若干相同的属性且分别对应星等，这时候可以省略$\theta$。在没有相同属性的情况下，自然连接的结果就是直接进行笛卡尔积。

外连接是一种扩展的连接运算，用于处理可能存在缺失信息的情况。外连接分为左外连接、右外连接和全外连接。就是在完成正常的连接之后，把其他的属性作为`null`写入，而引入在左侧（或者右侧）中没有被匹配进去的元组。

### 除

除可以视为笛卡尔积的逆运算，但是由于实际上得到的表已经是笛卡尔积的子集，所以这个运算已经被推广了。

除在进行的过程中，简单来说就是，查找被除数所有的元组，审阅除数含有的全部属性，找到其他属性值相同而那些除数的属性的值完全涵盖了除数的属性的值的元组。

### 广义投影

简单来说就是把选择的过程中，增加对某个域的每个值都进行一种操作（比如除以一个数等）。

### 聚集运算

聚集函数就是，将某一个属性的值进行某种操作，比如求和、平均值等。

聚集运算：

$$
_{G_1, G_2, \cdots, G_n}\mathcal{G}_{F_1(A_1), F_2(A_2), \cdots, F_m(A_m)}(E)
$$

其中，$G_1, G_2, \cdots, G_n$是分组属性，$F_1(A_1), F_2(A_2), \cdots, F_m(A_m)$是聚集函数。