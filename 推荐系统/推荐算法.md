# 推荐系统与推荐算法系统化笔记

推荐系统旨在为用户提供个性化的信息过滤与内容发现服务。其核心在于理解用户、物品及二者之间的关系，并通过算法实现高效、精准的推荐。以下从推荐系统的发展、主流算法、数学原理、评测方法与指标等方面系统梳理相关知识。

## 一、推荐系统发展与主流方法

推荐系统经历了从基于统计的简单方法到深度学习驱动的智能推荐的演进：

- **1.0 阶段**：统计方法（如热门推荐、关联规则），主要依赖物品流行度和共现关系。
- **2.0 阶段**：机器学习方法（如矩阵分解），通过离线建模预测用户兴趣。
- **3.0 阶段**：召回+排序（Learning to Rank），将候选物品召回后再用排序模型优化推荐顺序。
- **4.0 阶段**：实时化推荐，推荐结果能快速响应用户行为变化。
- **5.0 阶段**：端到端深度学习，所有实体均embedding化，模型端到端训练。
- **6.0 阶段**：智能化推荐，融合多模态、多源数据，具备自适应与推理能力。

推荐的结果一般分为：

- 大众化推荐，和具体用户关联不大，譬如查询的推荐、搜索词联想、Popular推荐等
- 个性化推荐，需要了解用户个体的喜好，算法基于用户行为数据分析设计

## 二、推荐算法体系与数学原理

### 1. 大众化推荐（Most Popular）

- **思想**：为所有用户推荐当前最热门的Top-K物品。
- **变种**：
    - 去除用户已交互物品。
    - 按用户属性（性别、年龄、国家等）分组推荐。
    - 结合用户活跃度调整推荐列表长度。
- **数学表达**：
    - 物品流行度：$ popularity(i) = \sum_{u \in U} r_{ui} $
    - 推荐列表：对每个用户$u$，推荐$ popularity(i) $最高的$K$个物品，$i \notin I_u$（$I_u$为用户$u$已交互物品集）。

### 2. 基于关联规则的推荐

- **核心**：挖掘物品间的共现关系，常用Apriori算法。
- **数学定义**：
    - **支持度**：$ support(X \rightarrow Y) = \frac{count(X \cup Y)}{N} $
    - **置信度**：$ confidence(X \rightarrow Y) = \frac{count(X \cup Y)}{count(X)} $
    - 规则筛选：$ support \geq \alpha $且$ confidence \geq \beta $（$\alpha, \beta$为阈值）。
- **应用**：适合超市购物篮分析、导航等场景，强调知识发现而非个性化。

### 3. 基于人口统计的推荐（Demographic-based）

- **思想**：利用用户属性（性别、年龄、地区等）计算用户间相似度，推荐相似用户喜欢的物品。
- **优缺点**：无冷启动，领域独立，但推荐粗糙且隐私敏感。
- **数学表达**：
    - 用户相似度（如欧氏距离、余弦相似度）基于人口统计特征向量。
    - 推荐：对目标用户$u$，找相似用户集合$S(u)$，推荐$S(u)$喜欢且$u$未交互的物品。

### 4. 基于内容的推荐（Content-based）

- **思想**：分析物品属性与用户历史行为，建立用户兴趣画像。
- **流程**：
    1. 物品标签化（如TF-IDF、one-hot、embedding等）。
    2. 用户兴趣建模：$ profile(u) = \sum_{i \in I_u} w_{ui} \cdot feature(i) $，$w_{ui}$为权重（如浏览/购买/评分）。
    3. 相似度计算：如余弦相似度$ sim(u, i) = \frac{profile(u) \cdot feature(i)}{\|profile(u)\|\|feature(i)\|} $。
- **可用模型**：Naive Bayes、KNN、SVM等文本分类器。
- **优缺点**：可解释性强，适合小众兴趣，但特征提取难、用户冷启动、难有惊喜。

### 5. 基于协同过滤的推荐（Collaborative Filtering, CF）

- **思想**：利用用户-物品交互矩阵，挖掘用户间或物品间的相似性。
- **类型**：
    - **基于用户的CF**：$ sim(u, v) $，推荐相似用户喜欢的物品。
    - **基于物品的CF**：$ sim(i, j) $，推荐与用户历史物品相似的物品。
- **数学推导**：
    - **相似度计算**（以余弦为例）：$ sim(u, v) = \frac{\sum_{i} r_{ui} r_{vi}}{\sqrt{\sum_{i} r_{ui}^2} \sqrt{\sum_{i} r_{vi}^2}} $
    - **预测评分**（用户CF）：$ \hat{r}_{ui} = \bar{r}_u + \frac{\sum_{v \in N(u)} sim(u, v) (r_{vi} - \bar{r}_v)}{\sum_{v \in N(u)} |sim(u, v)|} $
    - **矩阵分解**（如SVD）：$ R \approx U \cdot V^T $，$U$为用户隐向量，$V$为物品隐向量，优化目标$\min \sum_{(u,i) \in K} (r_{ui} - U_u^T V_i)^2 + \lambda(\|U_u\|^2 + \|V_i\|^2)$
- **优缺点**：无需领域知识，易于工程实现，但有冷启动、兴趣漂移等问题。

---

## 三、推荐系统评测方法与指标

### 1. 评测方法

- **离线实验**：用历史数据集分训练/测试集，评测预测能力（如准确率、召回率）。
- **用户调查**：问卷等方式收集主观反馈，评测满意度。
- **在线实验（AB测试）**：真实用户分组对比，统计点击率、转化率等商业指标。

### 2. 评测指标与数学定义

- **用户满意度**：点击率、停留时间、转化率等。
- **预测准确度**：
    - **评分预测**：
        - MAE：$ MAE = \frac{1}{N} \sum_{(u,i)} |r_{ui} - \hat{r}_{ui}| $
        - RMSE：$ RMSE = \sqrt{\frac{1}{N} \sum_{(u,i)} (r_{ui} - \hat{r}_{ui})^2} $
    - **分类准确度**：
        - 精确率（Precision）：$ P = \frac{TP}{TP+FP} $
        - 召回率（Recall）：$ R = \frac{TP}{TP+FN} $
        - F1：$ F1 = \frac{2PR}{P+R} $
        - AUC：ROC曲线下的面积
    - **排序准确度**：
        - MRR（Mean Reciprocal Rank）：$ MRR = \frac{1}{|Q|} \sum_{i=1}^{|Q|} \frac{1}{rank_i} $
        - NDCG（归一化折扣累积增益）：$ NDCG@k = \frac{DCG@k}{IDCG@k} $，其中$ DCG@k = \sum_{i=1}^k \frac{rel_i}{\log_2(i+1)} $
- **覆盖率**：$ coverage = \frac{|\bigcup_{u \in U} R(u)|}{|I|} $，$R(u)$为用户$u$的推荐列表，$I$为物品全集。
- **多样性**：推荐列表中物品两两不相似性的均值。
- **新颖性**：推荐物品的平均流行度（越低越新颖）。
- **惊喜度**：推荐结果与历史兴趣不相似但用户满意。
- **信任度**：系统透明度、可解释性。
- **实时性**：推荐列表对用户行为和新物品的响应速度。
- **健壮性**：抗击作弊能力，如防刷单、注入攻击。
- **商业目标**：综合优化准确度、覆盖率、多样性、新颖性等。

---

## 四、评测维度与综合优化

- **用户维度**：人口统计信息、活跃度、新用户等。
- **物品维度**：属性、流行度、新物品等。
- **时间维度**：季节、时段等。

实际应用中，推荐系统需在准确度、覆盖率、多样性、新颖性、实时性、健壮性等多指标、多维度下综合优化，针对不同场景灵活调整算法与评测体系。

